<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8">
  
  <style>
    body {
  
      background-color: black;
      color: #10EEEE;
    }

    h1 {
      
      text-align: center;

    }

    form {
     
      margin-top: 330px;
      margin-left: 100px;
    }

    input {
     
      margin: 5px;
      padding: 5px;
      color: #10EEEE;

    }

    input[type=text] {
       
      width: 70%;
      border-color: #10EEEE;
      background-color: #000c0c;
    }

    input[type=submit] {
       
      margin-top: 30px;
    }

    input[type=radio], input[type=checkbox] {

      display: none;
    }

    input + label {

      display: block;
      margin-top: 10px;
      margin-left: 15px;
    }

    .indicator_box {

      display: inline-block;
      box-sizing: border-box;
      width: 1.5em;
      height: 1.5em;
      border-style: dashed;
      padding: 0.25em;
      margin-right: 10px;
    }

    input:checked + label > .indicator_box::after {

      display: block;
      content: '';
      margin: 0 auto;
      width: 0.6em;
      height: 0.6em;
      background-color: #10EEEE;

    }

    label > *:hover, .text_button:hover {

      cursor: pointer;
    }

    .subsection {

       margin-top: 30px;
       margin-bottom: 0px;
    }

    #meta_buttons {
     
       margin-top: 100px;
       float: right;
    }

    #meta_buttons > button {

        margin-top: 10px;
    }

    .text_button {

       border-style: solid;
       border-color: #10EEEE;
       color: #10EEEE;
       background-color: transparent;
       display: block;
    }
    
    .text_button:hover {

       background-color: #004b4b;
    }

    #action_box {
  
       border: 1px dashed; 
       margin-top: 50px;
       margin-left: 100px;
       padding: 10px;
       width: 80%;
       height: 600px;
       display: none;
       white-space: pre-line;
       overflow: auto;
    }

  </style>
 </head>
 <body>

  <div id="main_display">

   <h1>Shadow Tune</h1>

   <div id="meta_buttons">
        <button type="button" class="text_button" onclick="get_help()">Help</button>
        <button type="button" class="text_button" onclick="terminate()">Back to the shadows</button>
   </div>
  
   <form id="shadow_form">
    
     <span>Path to Shadowrun game folder:</span><input type="text" name="sr_install"><br>
    
     <span>New resources.assets.resS file:</span><input type="text" name="new_resS"><br>
    
     <p class="subsection">Action:</p><br>
      
        <input type="radio" name="action" id="action1" value="swap" checked>
	<label for="action1">
	  <div class="indicator_box"></div>
	  <span class="indicator_text">Replace</span>
	</label>
      
        <input type="radio" name="action" id="action2" value="restore">

	<label for="action2">
	  <div class="indicator_box"></div>
	  <span class="indicator_text">Restore</span>
	</label>
    
     <p class="subsection">Shadowrun game:</p><br>
      
        <input type="radio" name="edition" id="edition1" value="Returns" checked>
	<label for="edition1">
	  <div class="indicator_box"></div>
	  <span class="indicator_text">Shadowrun Returns</span>
	</label>
      
        <input type="radio" name="edition" id="edition2" value="Dragonfall">

	<label for="edition2">
	  <div class="indicator_box"></div>
	  <span class="indicator_text">Shadowrun Dragonfall</span>
	</label>
      
        <input type="radio" name="edition" id="edition3" value="Hongkong">

	<label for="edition3">
	  <div class="indicator_box"></div>
	  <span class="indicator_text">Shadowrun Hong Kong</span>
	</label>
    
     <p class="subsection">Other options:</p><br>
      
        <input type="checkbox" name="verbose" id="check1" value=1>

        <label for="check1">
          <div class="indicator_box"></div>
	  <span class="indicator_text">Verbose output</span>
        </label>
    
     <input type="submit" class="text_button" value="Go">
  
   </form>

   <div id="action_box"></div>
  
  </div>
  <script>
     
     function toggle_box() { document.getElementById("action_box").style.display = "block"; }

     function get_help() {
          
          var xhreq = new XMLHttpRequest();
          xhreq.addEventListener("load", function(event) {
          
                   toggle_box();
                   document.getElementById("action_box").innerHTML = this.responseText;
               
          });
          xhreq.open("GET", "/help", true);
          xhreq.send();
     }

     function terminate() {

          var xhreq = new XMLHttpRequest();
	  xhreq.addEventListener("load", function(event) {
          
	           var text_area = document.getElementById("main_display");
                   
		   Object.assign(text_area.style, {position: "absolute", top: "50%", left: "50%", transform: "translateX(-50%) translateY(-50%)"});
                   text_area.innerHTML = this.responseText;
               
          });
          xhreq.open("GET", "/SESSIONKEY", true);
          xhreq.send();


     }

     function create_query(form) {
              
	  var query_string = "";

	  for (i = 0; i < form.length; i++) {

              if (form.elements[i].value && form.elements[i].type != "submit") {

                 if ((form.elements[i].type == "radio" || form.elements[i].type == "checkbox") && ! form.elements[i].checked)
                    continue;

                 query_string += form.elements[i].name + "=" + form.elements[i].value + "&"; 

	      } 

	  }

	  query_string = query_string.replace(/\s+/g, "+");

          return query_string.slice(0, -1);    
     }

     function create_msg(id, msg) {

          var info_msg = document.createElement("div");
          Object.assign(info_msg.style, {marginTop: "30px", marginLeft: "100px" });
	  info_msg.id = id;
	  if (msg) { info_msg.innerHTML = msg; }
          
	  if ( ! document.getElementById(id) ) {

             document.getElementById("main_display").insertBefore(info_msg, document.getElementById("action_box")); 

	  }

     }

     function remove_msg(id) {

          var info_msg = document.getElementById(id);
          if (info_msg) { info_msg.parentNode.removeChild(info_msg); }

     }

     function send_form() {

          var xhreq = new XMLHttpRequest();
	  var query = create_query(document.getElementById("shadow_form"));
	  create_msg("progress");


          xhreq.addEventListener("load", function(event) {
	       document.getElementById("progress").innerHTML = "Operation completed.";
               toggle_box();
               document.getElementById("action_box").innerHTML= this.responseText;
          });

          xhreq.addEventListener("error", function(event) {
	       document.getElementById("progress").innerHTML = "There was an error while communicating with the server.";

          });


          xhreq.open("POST", "/", true);
	  xhreq.setRequestHeader("Content-type","application/x-www-form-urlencoded");
          xhreq.send(query);
          document.getElementById("progress").innerHTML = "Working on the game files...";

     } 

     document.getElementById("shadow_form").addEventListener("submit", function (event) {
          event.preventDefault();

          if (document.forms[0]["new_resS"].value == "") {

	     create_msg("resS_warning", "You must provide a new resources.assets.resS file!");

          }   
          else {

	       remove_msg("resS_warning");
               send_form();

          }
     })
  </script>
 </body>
</html>
